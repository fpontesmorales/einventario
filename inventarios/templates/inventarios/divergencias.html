{% extends "admin/base_site.html" %}
{% block content %}
<h1>RelatÃ³rio de DivergÃªncias {% if inventario %}({{ inventario.ano }}){% endif %}</h1>

<form method="get" class="form-inline" style="margin: 12px 0; display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 8px; align-items: end;">
  <div>
    <label>Texto</label>
    <input type="text" name="q" value="{{ params.q }}" class="vTextField" placeholder="tombamento/descriÃ§Ã£o/responsÃ¡vel">
  </div>
  <div>
    <label>Bloco</label>
    <input type="text" name="bloco" value="{{ params.bloco }}" class="vTextField" placeholder="ex.: Bloco A">
  </div>
  <div>
    <label>Sala</label>
    <select name="sala" class="vTextField">
      <option value="">Todas</option>
      {% for s in salas %}
        <option value="{{ s.id }}" {% if params.sala|default:'' == s.id|stringformat:"s" %}selected{% endif %}>{{ s.nome }}{% if s.bloco %} ({{ s.bloco }}){% endif %}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label>Vistoriador</label>
    <select name="vistoriador" class="vTextField">
      <option value="">Todos</option>
      {% for u in vistoriadores %}
        <option value="{{ u.id }}" {% if params.vistoriador|default:'' == u.id|stringformat:"s" %}selected{% endif %}>{{ u.get_username }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <button class="button">Filtrar</button>
    <a class="button" href="{% url 'inventarios:relatorio_divergencias_csv' %}?{{ request.GET.urlencode }}">Exportar CSV</a>
  </div>
</form>

<div class="module" style="padding:10px;margin-bottom:12px;">
  <strong>Total:</strong> {{ total }} &nbsp;|&nbsp;
  <strong>Sala diferente:</strong> {{ por_sala }} &nbsp;|&nbsp;
  <strong>Estado diferente:</strong> {{ por_estado }} &nbsp;|&nbsp;
  <strong>Ambos:</strong> {{ ambos }}
</div>

<table class="adminlist table table-striped">
  <thead>
    <tr>
      <th>Tombamento</th>
      <th>DescriÃ§Ã£o</th>
      <th>Sala oficial</th>
      <th>Sala encontrada</th>
      <th>Estado (cad.)</th>
      <th>Estado (vist.)</th>
      <th>Resp. (cad.)</th>
      <th>Resp. (vist.)</th>
      <th>Vistoria</th>
    </tr>
  </thead>
  <tbody>
    {% for i in itens %}
    <tr>
      <td>{{ i.tombamento }}</td>
      <td>{{ i.descricao }}</td>
      <td>{{ i.sala_oficial }}</td>
      <td>{{ i.sala_encontrada }}</td>
      <td>{{ i.estado_cadastro }}</td>
      <td>{{ i.estado_encontrado }}</td>
      <td>{{ i.responsavel_cadastro }}</td>
      <td>{{ i.responsavel_encontrado }}</td>
      <td><a href="{% url 'admin:inventarios_vistoria_change' i.vistoria_id %}">{{ i.vistoria_id }}</a></td>
    </tr>
    {% empty %}
    <tr><td colspan="9">Sem divergÃªncias.</td></tr>
    {% endfor %}
  </tbody>
</table>

{% if page.paginator.num_pages > 1 %}
<div class="paginator">
  <span class="step-links">
    {% if page.has_previous %}
      <a href="?{% if qs_base %}{{ qs_base }}&{% endif %}p=1">&laquo; primeiro</a>
      <a href="?{% if qs_base %}{{ qs_base }}&{% endif %}p={{ page.previous_page_number }}">anterior</a>
    {% endif %}

    <span class="current">
      PÃ¡gina {{ page.number }} de {{ page.paginator.num_pages }}
    </span>

    {% if page.has_next %}
      <a href="?{% if qs_base %}{{ qs_base }}&{% endif %}p={{ page.next_page_number }}">prÃ³ximo</a>
      <a href="?{% if qs_base %}{{ qs_base }}&{% endif %}p={{ page.paginator.num_pages }}">Ãºltimo &raquo;</a>
    {% endif %}
  </span>
</div>
{% endif %}

{% endblock %}