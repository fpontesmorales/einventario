{% extends "mobile/base.html" %}
{% block content %}
<a class="btn btn-link" href="{% url 'mobile_home' %}">← Salas</a>
<h5 class="mb-3">{{ sala.nome }}{% if sala.bloco %} ({{ sala.bloco }}){% endif %}</h5>

<form class="d-flex gap-2 mb-3 stack-sm" method="post" action="{% url 'mobile_buscar_tombamento' sala.id %}">
  {% csrf_token %}
  <input class="form-control" name="q" placeholder="Procurar tombamento nesta sala">
  <button class="btn btn-primary">Buscar</button>
  <a class="btn btn-outline-secondary" href="{% url 'mobile_fechar_sala' sala.id %}">Restantes → Não Localizados</a>
  <a class="btn btn-warning" href="{% url 'mobile_sem_registro' sala.id %}">Adicionar Sem Registro</a>
</form>

<h6 class="mt-3">Bens desta sala</h6>
<ul class="list-group mb-4">
  {% for b in bens %}
    {% with v=b.v_atual %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <a href="{% url 'mobile_bem_acao' b.id %}?sala={{ sala.id }}"
           class="{% if v and v.status == 'DIVERGENTE' and v.sala_encontrada_id != sala.id %}risco{% endif %}">
          <strong>{{ b.tombamento }}</strong> – {{ b.descricao }}
        </a>
        {% if v %}
          {% if v.status == 'CONFERIDO' %}<span class="chip ms-2">Conferido</span>{% endif %}
          {% if v.status == 'DIVERGENTE' %}<span class="chip ms-2">Divergente{% if v.sala_encontrada and v.sala_encontrada_id != sala.id %} (encontrado em {{ v.sala_encontrada }}){% endif %}</span>{% endif %}
          {% if v.status == 'NAO_LOCALIZADO' %}<span class="chip ms-2">Não Localizado</span>{% endif %}
        {% endif %}
      </div>
      <a class="btn btn-sm btn-outline-primary" href="{% url 'mobile_bem_acao' b.id %}?sala={{ sala.id }}">Ação</a>
    </li>
    {% endwith %}
  {% empty %}
    <li class="list-group-item">Sem bens.</li>
  {% endfor %}
</ul>

{% if extras %}
<h6>Encontrados aqui, mas oficiais de outra sala</h6>
<ul class="list-group">
  {% for v in extras %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <strong>{{ v.bem.tombamento }}</strong> – {{ v.bem.descricao }}
        <span class="chip ms-2">De: {{ v.bem.sala_oficial }}</span>
      </div>
      <a class="btn btn-sm btn-outline-primary" href="{% url 'mobile_bem_acao' v.bem.id %}?sala={{ sala.id }}">Ação</a>
    </li>
  {% endfor %}
</ul>
{% endif %}
{% endblock %}
